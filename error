
FROM dmsrepo.optum.com/dms/ocrmypdf:1.0 AS base

ENV LANG=C.UTF-8
ENV TZ=UTC

RUN apk add --no-cache \
    bash
RUN bash --version
RUN java --version
# Install uv if not installed
COPY --from=ghcr.io/astral-sh/uv:0.5.5 /uv /uvx /bin/
# Create the virtual environment
RUN uv venv --system-site-packages .venv

# Install pip manually inside the virtualenv
RUN uv pip install --upgrade pip && \
    uv pip install ocrmypdf

WORKDIR /app

# # Copy the application JAR file to the container
COPY target/pdf-process-0.0.1-SNAPSHOT.jar app.jar

# # Copy the application-docker.properties file to the container
COPY src/main/resources/application-docker.properties application.properties

# # Expose the port the application runs on
EXPOSE 9040

# Run the application
# ENTRYPOINT ["/app/.venv/bin/ocrmypdf"]
ENTRYPOINT ["java", "-jar", "/app/app.jar"]
# podman build -f Dockerfile --tag=docker.optum.com/dms/pdf-processing:1.0 .
